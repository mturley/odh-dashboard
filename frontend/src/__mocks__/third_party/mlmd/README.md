# Third-Party Generated Protobuf Code for MLMD mocks

The code in this directory is similar to the code in `frontend/src/third_party/mlmd`, but was generated with [a different tool called ts-proto](https://www.npmjs.com/package/ts-proto). In both cases, the generated code is used for serializing and deserializing [gRPC](https://grpc.io) message objects, which are defined by [Protobuf .proto schema files](https://protobuf.dev/programming-guides/proto2/).

The code used in production (in `frontend/src/third_party/mlmd`) was copied [directly from Kubeflow here](https://github.com/kubeflow/pipelines/blob/master/frontend/src/third_party/mlmd/index.ts) in [odh-dashboard PR #2613](https://github.com/opendatahub-io/odh-dashboard/pull/2613), and was generated by [protoc-gen-js](https://github.com/protocolbuffers/protobuf-javascript) (see details of how that was built [in the Kubeflow frontend readme under "Building generated metadata Protocol Buffers"](https://github.com/kubeflow/pipelines/blob/master/frontend/README.md#building-generated-metadata-protocol-buffers)). We initially tried to reuse that code for mocking these objects in Cypress tests, but that implementation does not provide an easy way to serialize them from JSON which makes mocking inconvenient.

We found an alternate protobuf client generator [ts-proto](https://www.npmjs.com/package/ts-proto) which generates idiomatic TypeScript interfaces for expressing message objects more simply and encoding them in one line. This makes it easier to provide mock data for tests. We generated this alternate version of the code with it, which is currently **_only to be used for serializing mock data in tests and NOT for use in production_**. While the messages encoded by the two sets of generated code are compatible in theory, we wanted to avoid the risk associated with replacing production code that currently is guaranteed to exactly match the upstream Kubeflow frontend.

Note: Upstream Kubeflow is still using protoc-gen-js for MLMD, but there are other places in Kubeflow that have transitioned to ts-proto (see [kubeflow/pipelines PR #7125](https://github.com/kubeflow/pipelines/pull/7125)), so we may end up replacing the production code with ts-proto code in the future if Kubeflow adopts it for MLMD.

## How this code was generated

1. Installed the [protobuf runtime](https://github.com/protocolbuffers/protobuf) on Mac with `brew install protobuf`

2. In a new temporary directory: cloned the [google/ml-metadata repo](https://github.com/google/ml-metadata), installed [ts-proto](https://www.npmjs.com/package/ts-proto) from npm, created an empty `generated` directory, and ran the protoc command using ts-proto as a plugin and the `metadata_store_service.proto` file from the ml-metadata repo

   ```sh
   mkdir -p ~/tmp/mlmd
   cd ~/tmp/mlmd
   git clone git@github.com:google/ml-metadata.git
   npm install ts-proto
   mkdir generated
   protoc --plugin=./node_modules/.bin/protoc-gen-ts_proto -I=./ml-metadata --ts_proto_out=./generated --ts_proto_opt=esModuleInterop=true --ts_proto_opt=env=browser ./ml-metadata/ml_metadata/proto/metadata_store_service.proto
   ```

3. Copied the contents of the `generated` directory
