# Third-Party Generated Protobuf Code for MLMD mocks

The code in this directory is equivalent to the code in `frontend/src/third_party/mlmd`, but was generated with [a different tool called ts-proto](https://www.npmjs.com/package/ts-proto). This generated code is used for serializing and deserializing [gRPC](https://grpc.io) message objects, which are defined by [Protobuf .proto schema files](https://protobuf.dev/programming-guides/proto2/).

The code used in production (in `frontend/src/third_party/mlmd`) was copied [directly from Kubeflow here](https://github.com/kubeflow/pipelines/blob/master/frontend/src/third_party/mlmd/index.ts) in [odh-dashboard PR #2613](https://github.com/opendatahub-io/odh-dashboard/pull/2613), and was generated by [protobuf.js](https://github.com/protobufjs/protobuf.js). We initially tried to reuse that code for mocking these objects in Cypress tests, but that implementation does not provide an easy way to serialize them from JSON which makes mocking inconvenient.

We found alternate protobuf client generators which include extra features such as a `.fromJSON` method which makes it easier to provide mock data for tests. We chose [ts-proto](<(https://www.npmjs.com/package/ts-proto)>) and generated this alternate version of the code with it, which is currently **_only to be used for serializing mock data in tests and NOT for use in production_**. While the two are compatible in theory, this avoids the risk associated with replacing production code that currently is guaranteed to exactly match the upstream Kubeflow frontend.

Note: MLMD is still using protobuf.js in the upstream Kubeflow repo, but there are other places in Kubeflow that have transitioned from protobuf.js to ts-proto (see [kubeflow/pipelines PR #7125](https://github.com/kubeflow/pipelines/pull/7125)), so we may end up replacing the production code with ts-proto code in the future.

## How this code was generated

1. Installed the [protobuf runtime](https://github.com/protocolbuffers/protobuf) on Mac with `brew install protobuf`

2. Created a temporary directory containing a clone of the [ml-metadata repo](https://github.com/google/ml-metadata)
   ```sh
   mkdir ~/tmp/mlmd
   cd ~/tmp/mlmd
   git clone git@github.com:google/ml-metadata.git
   ```
3. Installed ts-proto in the temporary directory

   ```sh
   npm install ts-proto
   ```

4. Within the temporary directory: installed ts-proto, created an empty `dist` directory and ran the protoc command using ts-proto as a plugin and sourcing the `metadata_store_service.proto` file from inside the ml-metadata clone

   ```sh
   mkdir dist
   protoc --plugin=./node_modules/.bin/protoc-gen-ts_proto -I=./ml-metadata --ts_proto_out=./dist ./ml-metadata/ml_metadata/proto/metadata_store_service.proto
   ```

5. Copied the resulting code from `dist`
